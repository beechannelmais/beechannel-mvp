'use client';
import Nav from '@/components/Nav'; import { listProfiles, upsertProfile, deleteProfile } from '@/lib/profiles'; import type { Profile } from '@/lib/types'; import Link from 'next/link'; import { useEffect, useState } from 'react'; import { currentUser } from '@/lib/auth';
function newProfile():Profile{ return { id: Math.random().toString(36).slice(2), name: 'Novo perfil', avatar: 'ðŸ™‚' }; }
export default function ProfilesPage(){ const [profiles,setProfiles]=useState<Profile[]>([]); const [editing,setEditing]=useState<Profile|null>(null);
useEffect(()=>{ if(!currentUser()) location.replace('/login'); setProfiles(listProfiles()); },[]);
function openEdit(p:Profile){ setEditing({...p}); } function saveEdit(){ if(!editing) return; upsertProfile(editing); setProfiles(listProfiles()); setEditing(null); }
return (<main><Nav/><div className="container py-8"><h1 className="text-2xl font-bold mb-4">Quem estÃ¡ assistindo?</h1><div className="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-6 gap-4">{profiles.map(p=>(<div key={p.id} className="card text-center"><div className="text-5xl">{p.avatar}</div><div className="font-medium">{p.name}</div><div className="mt-2 flex gap-2 justify-center"><Link className="btn" href={`/catalog?profile=${p.id}`}>Entrar</Link><button className="btn-outline" onClick={()=>openEdit(p)}>Editar</button><button className="btn-outline" onClick={()=>{deleteProfile(p.id); setProfiles(listProfiles());}}>Excluir</button></div></div>))}{profiles.length<6&&(<button onClick={()=>{const p=newProfile(); upsertProfile(p); setProfiles(listProfiles());}} className="card text-center hover:bg-white/10"><div className="text-5xl">âž•</div><div>Adicionar perfil</div></button>)}</div><div className="mt-6"><Link className="btn" href="/catalog">Ir para a vitrine (sem perfil)</Link></div></div>{editing&&(<div className="fixed inset-0 bg-black/60 flex items-center justify-center z-50"><div className="card w-full max-w-md"><h2 className="text-xl font-semibold mb-2">Editar perfil</h2><label className="block text-sm text-white/70 mb-1">Nome</label><input className="input w-full mb-3" value={editing.name} onChange={e=>setEditing({...editing, name:e.target.value})}/><label className="block text-sm text-white/70 mb-1">Avatar (emoji)</label><input className="input w-full mb-3" value={editing.avatar} onChange={e=>setEditing({...editing, avatar:e.target.value})}/><div className="flex justify-end gap-2"><button className="btn-outline" onClick={()=>setEditing(null)}>Cancelar</button><button className="btn" onClick={saveEdit}>Salvar</button></div></div></div>)}</main>);}
